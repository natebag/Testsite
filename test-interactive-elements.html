<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Elements Test Suite</title>
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: #1a1a2e;
      color: white;
      margin: 20px;
      line-height: 1.6;
    }
    .test-section { 
      background: #16213e; 
      padding: 20px; 
      margin: 20px 0; 
      border-radius: 8px;
      border: 1px solid #0F3460;
    }
    .test-result { 
      padding: 10px; 
      margin: 10px 0; 
      border-radius: 4px; 
      border-left: 4px solid;
    }
    .success { 
      background: rgba(0, 255, 0, 0.1); 
      border-color: #00ff00; 
      color: #90EE90;
    }
    .error { 
      background: rgba(255, 0, 0, 0.1); 
      border-color: #ff0000; 
      color: #FFB6C1;
    }
    .warning { 
      background: rgba(255, 255, 0, 0.1); 
      border-color: #ffff00; 
      color: #FFFF99;
    }
    button {
      background: #0F3460;
      color: white;
      border: 1px solid #00ff88;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #1e5f8b; }
    .summary { 
      font-size: 1.2em; 
      font-weight: bold; 
      text-align: center;
      padding: 20px;
      background: rgba(0, 255, 136, 0.1);
      border-radius: 8px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>üß™ MLG.clan Interactive Elements Test Suite</h1>
  
  <div class="test-section">
    <h2>Test Results</h2>
    <button onclick="runAllTests()">üöÄ Run All Tests</button>
    <button onclick="clearResults()">üßπ Clear Results</button>
    <div id="test-results"></div>
  </div>

  <div class="summary" id="summary" style="display: none;">
    <div id="summary-content"></div>
  </div>

  <script>
    class InteractiveElementTester {
      constructor() {
        this.results = [];
        this.testPages = [
          { name: 'Home Dashboard', url: 'index.html', tests: ['navigation', 'stats', 'cards'] },
          { name: 'Content Hub', url: 'content.html', tests: ['search', 'filters', 'sorting', 'submission'] },
          { name: 'Vote Vault', url: 'voting.html', tests: ['voting', 'sorting', 'leaderboard', 'modals'] },
          { name: 'Clan Management', url: 'clans.html', tests: ['creation', 'browser', 'search', 'modals'] },
          { name: 'Profile', url: 'profile.html', tests: ['editing', 'persistence', 'modals'] }
        ];
      }

      log(message, type = 'info') {
        const result = { message, type, timestamp: new Date().toLocaleTimeString() };
        this.results.push(result);
        this.displayResult(result);
      }

      displayResult(result) {
        const resultsContainer = document.getElementById('test-results');
        const div = document.createElement('div');
        div.className = `test-result ${result.type}`;
        div.innerHTML = `
          <strong>[${result.timestamp}]</strong> ${result.message}
        `;
        resultsContainer.appendChild(div);
        resultsContainer.scrollTop = resultsContainer.scrollHeight;
      }

      async testPageLoad(page) {
        try {
          const response = await fetch(page.url);
          if (response.ok) {
            this.log(`‚úÖ ${page.name} (${page.url}) - Page loads successfully`, 'success');
            return true;
          } else {
            this.log(`‚ùå ${page.name} (${page.url}) - HTTP ${response.status}`, 'error');
            return false;
          }
        } catch (error) {
          this.log(`‚ùå ${page.name} (${page.url}) - ${error.message}`, 'error');
          return false;
        }
      }

      async testPageInteractivity(page) {
        return new Promise((resolve) => {
          const iframe = document.createElement('iframe');
          iframe.src = page.url;
          iframe.style.width = '1px';
          iframe.style.height = '1px';
          iframe.style.position = 'absolute';
          iframe.style.left = '-9999px';
          
          iframe.onload = () => {
            try {
              const doc = iframe.contentDocument || iframe.contentWindow.document;
              let passed = 0;
              let total = 0;

              // Test navigation
              if (page.tests.includes('navigation')) {
                total++;
                const navLinks = doc.querySelectorAll('.nav-link, a[href]');
                if (navLinks.length > 0) {
                  passed++;
                  this.log(`‚úÖ ${page.name} - Navigation links found (${navLinks.length})`, 'success');
                } else {
                  this.log(`‚ùå ${page.name} - No navigation links found`, 'error');
                }
              }

              // Test interactive elements
              if (page.tests.includes('search')) {
                total++;
                const searchInputs = doc.querySelectorAll('input[type="text"], input[placeholder*="search" i]');
                if (searchInputs.length > 0) {
                  passed++;
                  this.log(`‚úÖ ${page.name} - Search functionality found`, 'success');
                } else {
                  this.log(`‚ùå ${page.name} - No search inputs found`, 'error');
                }
              }

              // Test forms
              if (page.tests.includes('submission') || page.tests.includes('creation') || page.tests.includes('editing')) {
                total++;
                const forms = doc.querySelectorAll('form');
                if (forms.length > 0) {
                  passed++;
                  this.log(`‚úÖ ${page.name} - Forms found (${forms.length})`, 'success');
                } else {
                  this.log(`‚ùå ${page.name} - No forms found`, 'error');
                }
              }

              // Test buttons
              total++;
              const buttons = doc.querySelectorAll('button');
              if (buttons.length > 0) {
                passed++;
                this.log(`‚úÖ ${page.name} - Interactive buttons found (${buttons.length})`, 'success');
              } else {
                this.log(`‚ùå ${page.name} - No buttons found`, 'error');
              }

              // Test modals
              if (page.tests.includes('modals')) {
                total++;
                const modals = doc.querySelectorAll('[id*="modal"], .modal, [class*="modal"]');
                if (modals.length > 0) {
                  passed++;
                  this.log(`‚úÖ ${page.name} - Modal elements found (${modals.length})`, 'success');
                } else {
                  this.log(`‚ùå ${page.name} - No modal elements found`, 'error');
                }
              }

              // Test filters/sorting
              if (page.tests.includes('filters') || page.tests.includes('sorting')) {
                total++;
                const filterElements = doc.querySelectorAll('[data-filter], [data-sort], .filter, .sort');
                if (filterElements.length > 0) {
                  passed++;
                  this.log(`‚úÖ ${page.name} - Filter/Sort elements found (${filterElements.length})`, 'success');
                } else {
                  this.log(`‚ùå ${page.name} - No filter/sort elements found`, 'error');
                }
              }

              // Test JavaScript classes
              total++;
              const hasJavaScript = doc.querySelector('script');
              if (hasJavaScript && hasJavaScript.textContent.includes('class ')) {
                passed++;
                this.log(`‚úÖ ${page.name} - JavaScript classes detected`, 'success');
              } else {
                this.log(`‚ö†Ô∏è ${page.name} - JavaScript classes not clearly detected`, 'warning');
              }

              document.body.removeChild(iframe);
              resolve({ passed, total, percentage: Math.round((passed / total) * 100) });
            } catch (error) {
              this.log(`‚ùå ${page.name} - Error testing interactivity: ${error.message}`, 'error');
              document.body.removeChild(iframe);
              resolve({ passed: 0, total: 1, percentage: 0 });
            }
          };

          iframe.onerror = () => {
            this.log(`‚ùå ${page.name} - Failed to load in iframe`, 'error');
            document.body.removeChild(iframe);
            resolve({ passed: 0, total: 1, percentage: 0 });
          };

          document.body.appendChild(iframe);
        });
      }

      async testLocalStorage() {
        try {
          // Test localStorage availability
          localStorage.setItem('mlg_test', 'test_value');
          const value = localStorage.getItem('mlg_test');
          localStorage.removeItem('mlg_test');
          
          if (value === 'test_value') {
            this.log('‚úÖ localStorage functionality working', 'success');
            
            // Check for existing MLG data
            const keys = Object.keys(localStorage).filter(key => key.startsWith('mlg_'));
            if (keys.length > 0) {
              this.log(`‚úÖ Found ${keys.length} MLG data entries in localStorage`, 'success');
              keys.forEach(key => {
                const data = localStorage.getItem(key);
                if (data && data.length > 0) {
                  this.log(`  üì¶ ${key}: ${Math.round(data.length / 1024 * 10) / 10} KB`, 'success');
                }
              });
            } else {
              this.log('‚ö†Ô∏è No MLG data found in localStorage', 'warning');
            }
            return true;
          }
        } catch (error) {
          this.log(`‚ùå localStorage test failed: ${error.message}`, 'error');
          return false;
        }
      }

      async testAPI() {
        // Test API endpoints are defined
        const apiTests = [
          'MLGApiClient',
          'MLGVotingIntegration', 
          'MLGErrorHandler',
          'MLGWebSocketManager'
        ];

        let apiScore = 0;
        apiTests.forEach(api => {
          if (window[api]) {
            this.log(`‚úÖ ${api} is available`, 'success');
            apiScore++;
          } else {
            this.log(`‚ùå ${api} not found`, 'error');
          }
        });

        return { passed: apiScore, total: apiTests.length, percentage: Math.round((apiScore / apiTests.length) * 100) };
      }

      async runAllTests() {
        this.results = [];
        document.getElementById('test-results').innerHTML = '';
        
        this.log('üöÄ Starting comprehensive interactive elements test...', 'success');
        
        let totalPassed = 0;
        let totalTests = 0;
        const pageResults = [];

        // Test each page
        for (const page of this.testPages) {
          this.log(`\nüìã Testing ${page.name}...`, 'info');
          
          const pageLoads = await this.testPageLoad(page);
          if (pageLoads) {
            const interactivityResult = await this.testPageInteractivity(page);
            pageResults.push({
              name: page.name,
              ...interactivityResult
            });
            totalPassed += interactivityResult.passed;
            totalTests += interactivityResult.total;
          } else {
            pageResults.push({
              name: page.name,
              passed: 0,
              total: 1,
              percentage: 0
            });
            totalTests += 1;
          }
        }

        // Test system components
        this.log('\nüîß Testing System Components...', 'info');
        const storageWorks = await this.testLocalStorage();
        const apiResult = await this.testAPI();
        
        totalPassed += (storageWorks ? 1 : 0) + apiResult.passed;
        totalTests += 1 + apiResult.total;

        // Generate summary
        const overallPercentage = Math.round((totalPassed / totalTests) * 100);
        this.displaySummary(pageResults, overallPercentage, totalPassed, totalTests);
        
        this.log(`\nüèÅ Testing complete! Overall score: ${overallPercentage}% (${totalPassed}/${totalTests})`, 
          overallPercentage >= 80 ? 'success' : overallPercentage >= 60 ? 'warning' : 'error');
      }

      displaySummary(pageResults, overallPercentage, totalPassed, totalTests) {
        const summaryDiv = document.getElementById('summary');
        const contentDiv = document.getElementById('summary-content');
        
        let summaryHTML = `
          <h2>üìä Test Summary</h2>
          <div style="font-size: 2em; margin: 20px 0;">
            Overall Score: ${overallPercentage}% (${totalPassed}/${totalTests} tests passed)
          </div>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
        `;
        
        pageResults.forEach(page => {
          const color = page.percentage >= 80 ? '#00ff88' : page.percentage >= 60 ? '#ffff00' : '#ff6b6b';
          summaryHTML += `
            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid ${color};">
              <div style="font-weight: bold;">${page.name}</div>
              <div style="font-size: 1.5em; color: ${color};">${page.percentage}%</div>
              <div style="font-size: 0.9em; opacity: 0.8;">${page.passed}/${page.total} tests</div>
            </div>
          `;
        });
        
        summaryHTML += '</div>';
        
        if (overallPercentage >= 90) {
          summaryHTML += '<div style="margin-top: 20px; color: #00ff88;">üéâ Excellent! All systems operational!</div>';
        } else if (overallPercentage >= 80) {
          summaryHTML += '<div style="margin-top: 20px; color: #ffff00;">‚ö†Ô∏è Good performance with minor issues</div>';
        } else {
          summaryHTML += '<div style="margin-top: 20px; color: #ff6b6b;">‚ùå Several issues need attention</div>';
        }
        
        contentDiv.innerHTML = summaryHTML;
        summaryDiv.style.display = 'block';
      }

      clearResults() {
        this.results = [];
        document.getElementById('test-results').innerHTML = '';
        document.getElementById('summary').style.display = 'none';
        this.log('üßπ Test results cleared', 'info');
      }
    }

    const tester = new InteractiveElementTester();
    
    function runAllTests() {
      tester.runAllTests();
    }
    
    function clearResults() {
      tester.clearResults();
    }

    // Auto-run tests on page load
    window.onload = () => {
      tester.log('‚úÖ Interactive Elements Test Suite loaded', 'success');
      tester.log('Click "Run All Tests" to start comprehensive testing', 'info');
    };
  </script>
</body>
</html>