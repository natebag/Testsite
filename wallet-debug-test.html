<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLG.clan - Wallet Debug Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-2xl font-bold mb-6 text-green-400">üîß MLG.clan Wallet Debug Test</h1>
        
        <div class="space-y-4">
            <div class="bg-gray-800 p-4 rounded-lg">
                <h2 class="text-lg font-semibold mb-2">Debug Information</h2>
                <div id="debug-info" class="text-sm space-y-1 text-gray-300"></div>
            </div>
            
            <div class="bg-gray-800 p-4 rounded-lg">
                <h2 class="text-lg font-semibold mb-2">Test Buttons</h2>
                <div class="space-x-2">
                    <button id="test-phantom" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                        Test Phantom Detection
                    </button>
                    <button id="test-manager" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
                        Test Wallet Manager
                    </button>
                    <button id="connect-wallet" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
                        Connect Wallet
                    </button>
                </div>
            </div>
            
            <div class="bg-gray-800 p-4 rounded-lg">
                <h2 class="text-lg font-semibold mb-2">Console Output</h2>
                <div id="console-output" class="text-xs bg-black p-2 rounded font-mono h-40 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <script type="module">
        // Console output capture
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };
        
        const consoleOutput = document.getElementById('console-output');
        
        function addToConsole(type, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const div = document.createElement('div');
            div.className = type === 'error' ? 'text-red-400' : 
                           type === 'warn' ? 'text-yellow-400' : 'text-gray-300';
            div.textContent = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // Call original console method
            originalConsole[type](...args);
        }
        
        console.log = (...args) => addToConsole('log', ...args);
        console.error = (...args) => addToConsole('error', ...args);
        console.warn = (...args) => addToConsole('warn', ...args);
        
        // Start debug
        console.log('üîß Starting wallet debug test...');
        
        // Debug info update
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debug-info');
            const info = [
                `‚Ä¢ Phantom Available: ${window.solana && window.solana.isPhantom ? '‚úÖ Yes' : '‚ùå No'}`,
                `‚Ä¢ Solana Web3 Loaded: ${typeof solanaWeb3 !== 'undefined' ? '‚úÖ Yes' : '‚ùå No'}`,
                `‚Ä¢ PhantomWalletManager: ${typeof window.phantomWalletManager !== 'undefined' ? '‚úÖ Available' : '‚ùå Not Available'}`,
                `‚Ä¢ Current URL: ${window.location.href}`,
                `‚Ä¢ User Agent: ${navigator.userAgent.slice(0, 100)}...`
            ];
            
            debugInfo.innerHTML = info.join('<br>');
        }
        
        updateDebugInfo();
        setInterval(updateDebugInfo, 2000);
        
        // Test Phantom Detection
        document.getElementById('test-phantom').addEventListener('click', async () => {
            console.log('üîç Testing Phantom detection...');
            
            if (window.solana && window.solana.isPhantom) {
                console.log('‚úÖ Phantom wallet detected');
                console.log('Phantom version:', window.solana._metadata?.version || 'Unknown');
                
                try {
                    const isConnected = window.solana.isConnected;
                    console.log('Connection status:', isConnected);
                    
                    if (isConnected) {
                        const publicKey = window.solana.publicKey;
                        console.log('Current publicKey:', publicKey?.toString() || 'None');
                    }
                } catch (error) {
                    console.error('Error checking Phantom status:', error);
                }
            } else {
                console.error('‚ùå Phantom wallet not detected');
                console.log('Available wallets:', Object.keys(window.solana || {}));
            }
        });
        
        // Test Manager Initialization
        document.getElementById('test-manager').addEventListener('click', async () => {
            console.log('üîß Testing wallet manager initialization...');
            
            try {
                // Try to import and initialize
                const { getWalletManager } = await import('./src/wallet/phantom-wallet.js');
                console.log('‚úÖ Successfully imported phantom-wallet.js');
                
                const manager = getWalletManager();
                console.log('‚úÖ Wallet manager created:', typeof manager);
                
                await manager.initializeConnection();
                console.log('‚úÖ Wallet manager initialized');
                
                window.phantomWalletManager = manager;
                console.log('‚úÖ Wallet manager assigned to window');
                
            } catch (error) {
                console.error('‚ùå Failed to initialize wallet manager:', error);
                console.error('Error details:', {
                    name: error.name,
                    message: error.message,
                    stack: error.stack?.split('\n').slice(0, 5).join('\n')
                });
            }
        });
        
        // Test Connect Wallet
        document.getElementById('connect-wallet').addEventListener('click', async () => {
            console.log('üîó Testing wallet connection...');
            
            if (!window.phantomWalletManager) {
                console.error('‚ùå Wallet manager not available. Run "Test Wallet Manager" first.');
                return;
            }
            
            try {
                console.log('Starting connection process...');
                const result = await window.phantomWalletManager.connect({
                    timeout: 10000,
                    autoApprove: false
                });
                
                console.log('‚úÖ Connection successful:', result);
                
                const connectionInfo = window.phantomWalletManager.getConnectionInfo();
                console.log('Connection info:', connectionInfo);
                
            } catch (error) {
                console.error('‚ùå Connection failed:', error);
                console.error('Error code:', error.code);
                console.error('Error type:', error.name);
            }
        });
        
        console.log('üîß Debug test initialized');
    </script>
</body>
</html>