<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vote Vault - MLG Token Burn Voting | MLG.clan</title>
  
  <!-- Meta Tags -->
  <meta name="description" content="Vote Vault - Democratic content voting powered by MLG token burns. Each vote costs tokens, creating real economic incentives.">
  <meta name="keywords" content="voting, token burn, MLG, gaming, esports, clan, DAO, blockchain, Solana">
  <meta name="author" content="MLG.clan Development Team">
  
  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://unpkg.com https://cdn.socket.io; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; img-src 'self' data: blob: https:; connect-src 'self' wss: https: ws://localhost:3000; frame-src 'self' https://www.youtube.com https://player.twitch.tv https://www.tiktok.com; font-src 'self' data:;">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üó≥Ô∏è</text></svg>">
  
  <!-- Standardized Module Loading System -->
  <script src="src/js/page-loader.js"></script>
  <script src="src/js/mlg-api-client-consolidated.js"></script>
  <script src="src/js/mlg-websocket-manager.js"></script>
  
  <!-- Consolidated Wallet & Voting Integration -->
  <script src="src/js/mlg-wallet-init-consolidated.js"></script>
  <meta name="mlg-wallet-auto-init" content="true">
  
  <style>
    /* Page-specific styles */
    
    /* Vote-specific styles */
    .vote-card {
      transition: all 0.3s ease;
      border: 1px solid rgba(0, 255, 136, 0.1);
    }
    
    .vote-card:hover {
      border-color: rgba(0, 255, 136, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 255, 136, 0.1);
    }
    
    .burn-animation {
      animation: burn 0.5s ease-in-out;
    }
    
    @keyframes burn {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); color: #ef4444; }
      100% { transform: scale(1); }
    }
    
    /* Vote button states */
    .vote-btn.vote-success {
      background: linear-gradient(45deg, #10b981, #34d399) !important;
      transform: scale(1.05);
      transition: all 0.3s ease;
    }
    
    .vote-btn.vote-error {
      background: linear-gradient(45deg, #ef4444, #f87171) !important;
      opacity: 0.8;
    }
    
    .loading-spinner {
      width: 16px;
      height: 16px;
      border: 2px solid #10b981;
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Vote count animation */
    .vote-count {
      transition: all 0.3s ease;
    }
    
    .vote-count.updating {
      animation: voteCountUpdate 0.5s ease-in-out;
    }
    
    .vote-count.real-time-update {
      animation: realTimeUpdate 1s ease-in-out;
    }
    
    @keyframes voteCountUpdate {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); color: #10b981; }
      100% { transform: scale(1); }
    }
    
    @keyframes realTimeUpdate {
      0% { background: transparent; }
      50% { background: rgba(16, 185, 129, 0.2); transform: scale(1.05); }
      100% { background: transparent; transform: scale(1); }
    }
  </style>
</head>
<body class="bg-gaming-bg text-white min-h-screen">
  
  <!-- Navigation Header -->
  <nav class="bg-black bg-opacity-60 backdrop-blur-md border-b border-gaming-accent border-opacity-20 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <a href="index.html" onclick="handleNavigation(event, 'index.html')" class="text-2xl font-bold text-gaming-accent flex items-center space-x-2 hover:text-green-400 transition-colors">
              <span class="animate-pulse">üéÆ</span>
              <span>MLG.clan</span>
            </a>
          </div>
          <div class="hidden md:block ml-10">
            <div class="flex items-baseline space-x-4">
              <a href="index.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-gaming-accent hover:bg-gaming-surface transition-colors" onclick="handleNavigation(event, 'index.html')">Dashboard</a>
              <a href="voting.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium bg-gaming-accent text-black transition-colors" onclick="handleNavigation(event, 'voting.html')">Vote Vault</a>
              <a href="clans.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-gaming-accent hover:bg-gaming-surface transition-colors" onclick="handleNavigation(event, 'clans.html')">Clans</a>
              <a href="content.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-gaming-accent hover:bg-gaming-surface transition-colors" onclick="handleNavigation(event, 'content.html')">Content Hub</a>
              <a href="dao.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-gaming-accent hover:bg-gaming-surface transition-colors" onclick="handleNavigation(event, 'dao.html')">DAO</a>
              <a href="analytics.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-gaming-accent hover:bg-gaming-surface transition-colors" onclick="handleNavigation(event, 'analytics.html')">Analytics</a>
            </div>
          </div>
        </div>
        
        <div class="flex items-center space-x-4">
          <!-- System Status -->
          <div id="system-status" class="flex items-center space-x-2">
            <div class="status-online">
              <i data-lucide="activity" class="w-4 h-4 text-gaming-accent"></i>
            </div>
            <span class="text-sm text-gaming-accent font-medium">All Systems Online</span>
          </div>
          
          <!-- Wallet Connection -->
          <button id="wallet-connect" class="bg-gaming-purple hover:bg-purple-600 px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
            <i data-lucide="wallet" class="w-4 h-4"></i>
            <span>Connect Phantom</span>
          </button>
          
          <!-- User Info (Hidden by default) -->
          <div id="user-info" class="hidden flex items-center space-x-3">
            <div class="flex items-center space-x-2 bg-gaming-surface px-3 py-1 rounded-lg">
              <div class="w-6 h-6 bg-gradient-to-r from-gaming-accent to-gaming-blue rounded-full"></div>
              <span id="user-address" class="text-sm font-mono"></span>
            </div>
            <div class="text-right">
              <div class="text-xs text-gray-400">MLG Balance</div>
              <div id="mlg-balance" class="text-sm font-bold text-gaming-yellow">0</div>
            </div>
            <a href="profile.html" onclick="handleNavigation(event, 'profile.html')" class="text-gray-300 hover:text-gaming-accent transition-colors">
              <i data-lucide="user" class="w-5 h-5"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Vote Vault Header -->
  <section class="relative py-16 overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-r from-gaming-bg via-gaming-surface to-gaming-bg opacity-50"></div>
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-5xl font-bold mb-6 text-gaming-accent animate-float">
        üó≥Ô∏è Vote Vault
      </h1>
      <p class="text-xl text-gray-300 mb-8 max-w-3xl mx-auto">
        Democratic content voting powered by MLG token burns. Each vote costs tokens, creating real economic incentives.
      </p>
      
      <!-- Vote Stats -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
        <div class="card-glow rounded-lg p-6">
          <div class="text-3xl font-bold text-gaming-accent" id="daily-votes">856</div>
          <div class="text-sm text-gray-400">Votes Today</div>
        </div>
        <div class="card-glow rounded-lg p-6">
          <div class="text-3xl font-bold text-gaming-red" id="tokens-burned">289K</div>
          <div class="text-sm text-gray-400">MLG Burned</div>
        </div>
        <div class="card-glow rounded-lg p-6">
          <div class="text-3xl font-bold text-gaming-blue" id="active-voters">5,621</div>
          <div class="text-sm text-gray-400">Active Voters</div>
        </div>
        <div class="card-glow rounded-lg p-6">
          <div class="text-3xl font-bold text-gaming-yellow" id="vote-cost">25</div>
          <div class="text-sm text-gray-400">MLG per Vote</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <section class="py-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        
        <!-- Voting Power Panel -->
        <div class="card-glow rounded-xl p-8">
          <h3 class="text-2xl font-bold text-gaming-accent mb-6 flex items-center">
            <i data-lucide="zap" class="w-6 h-6 mr-3"></i>
            Your Voting Power
          </h3>
          <div class="space-y-4">
            <div class="bg-gaming-surface rounded-lg p-4">
              <div class="flex justify-between items-center mb-2">
                <span class="text-gray-300">Daily Votes Remaining</span>
                <span class="text-2xl font-bold text-gaming-accent" id="votes-remaining">4/4</span>
              </div>
              <div class="w-full bg-gray-600 rounded-full h-2">
                <div class="bg-gaming-accent h-2 rounded-full" style="width: 100%" id="votes-progress"></div>
              </div>
            </div>
            
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-gray-300">MLG Token Balance</span>
                <span class="text-gaming-yellow font-bold" id="user-mlg-balance">1,250</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-300">Next Vote Cost</span>
                <span class="text-gaming-red font-bold">25 MLG</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-300">Your Votes Today</span>
                <span class="text-gaming-blue font-bold" id="user-votes-today">0</span>
              </div>
            </div>
            
            <button id="buy-votes" class="w-full bg-gaming-purple hover:bg-purple-600 px-6 py-3 rounded-lg font-bold transition-colors">
              Buy More Votes
            </button>
          </div>
        </div>

        <!-- Top Voters Leaderboard -->
        <div class="card-glow rounded-xl p-8">
          <h3 class="text-2xl font-bold text-gaming-accent mb-6 flex items-center">
            <i data-lucide="trophy" class="w-6 h-6 mr-3"></i>
            Top Voters
          </h3>
          <div class="space-y-3" id="voters-leaderboard">
            <!-- Dynamic leaderboard content -->
          </div>
        </div>

        <!-- Content Voting Section -->
        <div class="lg:col-span-2 card-glow rounded-xl p-8">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold text-gaming-accent flex items-center">
              <i data-lucide="trending-up" class="w-6 h-6 mr-3"></i>
              Trending Content
            </h3>
            <div class="flex space-x-2">
              <button class="vote-sort-btn bg-gaming-surface hover:bg-gaming-blue px-4 py-2 rounded-lg text-sm transition-colors" data-sort="latest">
                üïí Latest
              </button>
              <button class="vote-sort-btn bg-gaming-blue text-white px-4 py-2 rounded-lg text-sm" data-sort="trending">
                üî• Trending
              </button>
              <button class="vote-sort-btn bg-gaming-surface hover:bg-gaming-blue px-4 py-2 rounded-lg text-sm transition-colors" data-sort="top">
                üèÜ Top Rated
              </button>
              <button class="vote-sort-btn bg-gaming-surface hover:bg-gaming-blue px-4 py-2 rounded-lg text-sm transition-colors" data-sort="cost">
                üí∞ Vote Cost
              </button>
            </div>
          </div>
          
          <!-- Content Items -->
          <div class="space-y-4" id="content-list">
            
            <!-- Content Item 1 -->
            <div class="flex items-center justify-between p-4 bg-gaming-surface rounded-lg hover:bg-opacity-80 transition-all">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-12 bg-gradient-to-r from-red-500 to-purple-600 rounded-lg flex items-center justify-center">
                  <i data-lucide="play" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                  <h4 class="font-bold text-white">Epic Valorant Clutch - 1v5 Ace</h4>
                  <p class="text-sm text-gray-400">by ProGamer2024 ‚Ä¢ 2 hours ago</p>
                  <div class="flex items-center space-x-4 text-xs text-gray-500 mt-1">
                    <span>YouTube</span>
                    <span>‚Ä¢</span>
                    <span>2.4M views</span>
                    <span>‚Ä¢</span>
                    <span>98% upvoted</span>
                  </div>
                </div>
              </div>
              <div class="text-right flex items-center space-x-4">
                <div>
                  <div class="text-2xl font-bold text-gaming-accent vote-count" data-content-id="1">847</div>
                  <div class="text-xs text-gray-400">votes</div>
                </div>
                <button class="bg-gaming-accent hover:bg-green-400 text-black px-6 py-2 rounded-lg font-bold transition-colors vote-btn" data-content-id="1" data-cost="25">
                  Vote (25 MLG)
                </button>
              </div>
            </div>

            <!-- Content Item 2 -->
            <div class="flex items-center justify-between p-4 bg-gaming-surface rounded-lg hover:bg-opacity-80 transition-all">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-12 bg-gradient-to-r from-blue-500 to-teal-600 rounded-lg flex items-center justify-center">
                  <i data-lucide="play" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                  <h4 class="font-bold text-white">Insane Rocket League Air Dribble Goal</h4>
                  <p class="text-sm text-gray-400">by AerialMaster ‚Ä¢ 4 hours ago</p>
                  <div class="flex items-center space-x-4 text-xs text-gray-500 mt-1">
                    <span>TikTok</span>
                    <span>‚Ä¢</span>
                    <span>1.8M views</span>
                    <span>‚Ä¢</span>
                    <span>94% upvoted</span>
                  </div>
                </div>
              </div>
              <div class="text-right flex items-center space-x-4">
                <div>
                  <div class="text-2xl font-bold text-gaming-accent vote-count" data-content-id="2">623</div>
                  <div class="text-xs text-gray-400">votes</div>
                </div>
                <button class="bg-gaming-accent hover:bg-green-400 text-black px-6 py-2 rounded-lg font-bold transition-colors vote-btn" data-content-id="2" data-cost="25">
                  Vote (25 MLG)
                </button>
              </div>
            </div>

            <!-- Content Item 3 -->
            <div class="flex items-center justify-between p-4 bg-gaming-surface rounded-lg hover:bg-opacity-80 transition-all">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-12 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg flex items-center justify-center">
                  <i data-lucide="users" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                  <h4 class="font-bold text-white">MLG Elite vs Phoenix Rising - Epic Showdown</h4>
                  <p class="text-sm text-gray-400">by TournamentHQ ‚Ä¢ 6 hours ago</p>
                  <div class="flex items-center space-x-4 text-xs text-gray-500 mt-1">
                    <span>Twitch</span>
                    <span>‚Ä¢</span>
                    <span>847K views</span>
                    <span>‚Ä¢</span>
                    <span>96% upvoted</span>
                  </div>
                </div>
              </div>
              <div class="text-right flex items-center space-x-4">
                <div>
                  <div class="text-2xl font-bold text-gaming-accent vote-count" data-content-id="3">512</div>
                  <div class="text-xs text-gray-400">votes</div>
                </div>
                <button class="bg-gaming-accent hover:bg-green-400 text-black px-6 py-2 rounded-lg font-bold transition-colors vote-btn" data-content-id="3" data-cost="25">
                  Vote (25 MLG)
                </button>
              </div>
            </div>

          </div>
          
          <div class="mt-8 text-center">
            <button class="bg-gaming-surface hover:bg-gaming-blue px-8 py-3 rounded-lg font-bold transition-colors">
              Load More Content
            </button>
          </div>
        </div>
        
      </div>
      
      <!-- How It Works -->
      <div class="mt-16 card-glow rounded-xl p-8">
        <h3 class="text-2xl font-bold text-gaming-accent mb-6 text-center">How Vote Vault Works</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="text-center">
            <div class="w-16 h-16 bg-gaming-accent rounded-full flex items-center justify-center mx-auto mb-4">
              <i data-lucide="gift" class="w-8 h-8 text-black"></i>
            </div>
            <h4 class="font-bold text-white mb-2">Daily Free Votes</h4>
            <p class="text-sm text-gray-400">Every user gets 4 free votes daily to participate in content curation</p>
          </div>
          <div class="text-center">
            <div class="w-16 h-16 bg-gaming-red rounded-full flex items-center justify-center mx-auto mb-4">
              <i data-lucide="flame" class="w-8 h-8 text-white"></i>
            </div>
            <h4 class="font-bold text-white mb-2">Token Burn Mechanism</h4>
            <p class="text-sm text-gray-400">Additional votes cost 25 MLG tokens, which are permanently burned</p>
          </div>
          <div class="text-center">
            <div class="w-16 h-16 bg-gaming-purple rounded-full flex items-center justify-center mx-auto mb-4">
              <i data-lucide="trending-up" class="w-8 h-8 text-white"></i>
            </div>
            <h4 class="font-bold text-white mb-2">Economic Incentives</h4>
            <p class="text-sm text-gray-400">Token burning creates scarcity and gives votes real economic weight</p>
          </div>
          <div class="text-center">
            <div class="w-16 h-16 bg-gaming-blue rounded-full flex items-center justify-center mx-auto mb-4">
              <i data-lucide="users" class="w-8 h-8 text-white"></i>
            </div>
            <h4 class="font-bold text-white mb-2">Democratic Curation</h4>
            <p class="text-sm text-gray-400">Community decides what content deserves recognition and rewards</p>
          </div>
        </div>
      </div>
      
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-black bg-opacity-80 py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <a href="index.html" onclick="handleNavigation(event, 'index.html')" class="text-2xl font-bold mb-4 text-gaming-accent hover:text-green-400 transition-colors inline-block">üéÆ MLG.clan</a>
        <p class="text-gray-400 mb-6">The future of gaming communities is here.</p>
        <div class="flex justify-center space-x-8 text-sm text-gray-500">
          <span>Web3 Native</span>
          <span>‚Ä¢</span>
          <span>Enterprise Ready</span>
          <span>‚Ä¢</span>
          <span>Community Governed</span>
          <span>‚Ä¢</span>
          <span>100% Complete</span>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // Initialize platform
    class VotingPlatform {
      constructor() {
        this.userStats = {
          votesRemaining: 4,
          votesToday: 0,
          mlgBalance: 1250
        };
        this.votingData = null;
        this.init();
      }
      
      async init() {
        console.log('üó≥Ô∏è Initializing Voting Platform...');
        
        this.initializeUI();
        this.setupEventListeners();
        
        // Load data from API
        await this.loadVotingData();
        
        this.startRealTimeUpdates();
        this.startVotersLeaderboardUpdates();
        console.log('‚úÖ Voting Platform initialized successfully!');
      }
      
      initializeUI() {
        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
        }
        this.updateUserStats();
      }
      
      setupEventListeners() {
        // Vote buttons
        document.querySelectorAll('.vote-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const contentId = e.target.dataset.contentId;
            const cost = parseInt(e.target.dataset.cost);
            this.castVote(contentId, cost);
          });
        });
        
        // Buy votes button
        document.getElementById('buy-votes').addEventListener('click', () => {
          this.showBuyVotesDialog();
        });

        // Vote content sorting buttons
        document.querySelectorAll('.vote-sort-btn').forEach(sortBtn => {
          sortBtn.addEventListener('click', (e) => {
            this.setActiveVoteSortButton(e.target);
            this.sortVoteContent(e.target.dataset.sort);
          });
        });
      }
      
      async castVote(contentId, cost) {
        console.log(`üó≥Ô∏è Casting vote for content ${contentId} with cost ${cost} MLG`);
        
        try {
          // Find the vote button for this content
          const voteButton = document.querySelector(`.vote-btn[data-content-id="${contentId}"]`);
          
          // Check wallet connection first
          if (cost > 0 && !this.isWalletConnected()) {
            this.showNotification('‚ö†Ô∏è Please connect your Phantom wallet to vote with MLG tokens.', 'warning');
            return;
          }
          
          // Check if user has sufficient balance
          if (cost > this.userStats.mlgBalance) {
            this.showNotification('‚ùå Insufficient MLG balance. You need ' + cost + ' MLG to vote.', 'error');
            return;
          }
          
          // Show loading state on button
          if (voteButton) {
            voteButton.disabled = true;
            voteButton.innerHTML = `
              <div class="flex items-center justify-center space-x-2">
                <div class="loading-spinner"></div>
                <span>Voting...</span>
              </div>
            `;
          }
          
          // Execute vote with available systems
          await this.executeVote(contentId, cost);
          
          // Update vote count display immediately for better UX
          this.updateVoteCount(contentId);
          
          // Update local user stats after successful vote
          if (cost === 0) {
            this.userStats.votesRemaining = Math.max(0, this.userStats.votesRemaining - 1);
          } else {
            this.userStats.mlgBalance = Math.max(0, this.userStats.mlgBalance - cost);
          }
          
          this.userStats.votesToday++;
          this.updateUserStats();
          
          // Reset button state
          if (voteButton) {
            voteButton.disabled = false;
            voteButton.innerHTML = `Vote (${cost} MLG)`;
            voteButton.classList.add('vote-success');
            setTimeout(() => {
              voteButton.classList.remove('vote-success');
            }, 1000);
          }
          
          this.showNotification(`üî• Vote cast successfully! Burned ${cost} MLG tokens`, 'success');
          console.log('‚úÖ Vote completed successfully');
          
        } catch (error) {
          console.error('‚ùå Vote failed:', error);
          
          // Reset button state on error
          const voteButton = document.querySelector(`.vote-btn[data-content-id="${contentId}"]`);
          if (voteButton) {
            voteButton.disabled = false;
            voteButton.innerHTML = `Vote (${cost} MLG)`;
            voteButton.classList.add('vote-error');
            setTimeout(() => {
              voteButton.classList.remove('vote-error');
            }, 2000);
          }
          
          // Show user-friendly error message
          let errorMessage = 'Vote failed. Please try again.';
          if (error.message.includes('insufficient')) {
            errorMessage = 'Insufficient MLG tokens for this vote.';
          } else if (error.message.includes('wallet')) {
            errorMessage = 'Please connect your wallet first.';
          }
          
          this.showNotification(`‚ùå ${errorMessage}`, 'error');
        }
      }
      
      updateUserStats() {
        document.getElementById('votes-remaining').textContent = `${this.userStats.votesRemaining}/4`;
        document.getElementById('user-mlg-balance').textContent = this.userStats.mlgBalance.toLocaleString();
        document.getElementById('user-votes-today').textContent = this.userStats.votesToday;
        
        const progressPercent = (this.userStats.votesRemaining / 4) * 100;
        document.getElementById('votes-progress').style.width = `${progressPercent}%`;
      }
      
      updateVoteCount(contentId) {
        // Update vote count displays with proper selectors
        const voteCountElements = document.querySelectorAll(`.vote-count[data-content-id="${contentId}"]`);
        
        voteCountElements.forEach(element => {
          const currentVotes = parseInt(element.textContent) || 0;
          const newVotes = currentVotes + 1;
          
          // Animate the count update
          element.style.transform = 'scale(1.1)';
          element.style.color = '#10b981';
          element.textContent = newVotes;
          
          setTimeout(() => {
            element.style.transform = 'scale(1)';
            element.style.color = '';
          }, 300);
        });
        
        console.log(`‚úÖ Vote count updated for content ${contentId}`);
      }
      
      async executeVote(contentId, cost) {
        console.log(`üéØ Executing vote for content ${contentId} with cost ${cost} MLG`);
        
        // Try multiple voting systems in order of preference
        if (window.MLGVotingIntegration) {
          console.log('Using MLGVotingIntegration system...');
          const voteType = cost === 0 ? 'free-vote' : 'custom';
          return await window.MLGVotingIntegration.executeVote(contentId, voteType, cost);
        } else if (window.MLGApiClient && typeof window.MLGApiClient.castVote === 'function') {
          console.log('Using MLGApiClient system...');
          return await window.MLGApiClient.castVote(contentId, cost);
        } else {
          console.log('Using fallback voting system...');
          return await this.fallbackVote(contentId, cost);
        }
      }
      
      async fallbackVote(contentId, cost) {
        // Simulate blockchain transaction if using MLG tokens
        if (cost > 0) {
          console.log(`üí∞ Processing MLG token burn: ${cost} tokens`);
          // Simulate transaction delay
          await new Promise(resolve => setTimeout(resolve, 1500));
        }
        
        // Simulate vote processing
        await new Promise(resolve => setTimeout(resolve, 500));
        
        console.log('‚úÖ Fallback vote processed successfully');
        return { 
          success: true, 
          voteId: Date.now(),
          contentId: contentId,
          cost: cost,
          timestamp: new Date().toISOString()
        };
      }
      
      isWalletConnected() {
        // Check multiple wallet connection sources
        if (window.phantomWalletManager && window.phantomWalletManager.isConnected) {
          return window.phantomWalletManager.isConnected();
        }
        
        if (window.phantom && window.phantom.solana && window.phantom.solana.isConnected) {
          return true;
        }
        
        // For demo purposes, allow voting even without wallet for free votes
        return true;
      }
      
      async loadVotingData() {
        try {
          console.log('üìä Loading voting data from API...');
          
          // Show loading state
          window.mlgApi?.showLoading('main', {
            message: 'Loading voting data...',
            type: 'dashboard'
          });
          
          // Load voting data from API
          const response = await window.mlgApi.getVoting();
          
          if (response.success) {
            this.votingData = response;
            
            // Update user stats from API
            this.userStats = {
              votesRemaining: response.voting?.daily_votes_remaining || 4,
              votesToday: 4 - (response.voting?.daily_votes_remaining || 4),
              mlgBalance: response.voting?.mlg_balance || 1250
            };
            
            // Update live stats on page
            this.updateLiveStats();
            
            // Update trending content
            this.updateTrendingContent(response.trending_content || []);
            
            console.log('‚úÖ Voting data loaded from API');
          } else {
            throw new Error('API response not successful');
          }
          
        } catch (error) {
          console.error('Failed to load voting data:', error);
          
          // Show error notification
          this.showNotification('Failed to load voting data. Using fallback.', 'warning');
          
          // Use fallback data
          this.updateLiveStats();
        } finally {
          // Hide loading state
          window.mlgApi?.hideLoading('main');
        }
      }
      
      updateLiveStats() {
        const stats = {
          'daily-votes': this.votingData?.voting?.total_votes_today || (856 + Math.floor(Math.random() * 50)),
          'tokens-burned': this.votingData?.voting?.mlg_burned_today || (289000 + Math.floor(Math.random() * 1000)),
          'active-voters': this.votingData?.voting?.active_voters || (5621 + Math.floor(Math.random() * 100)),
          'vote-cost': this.votingData?.voting?.next_vote_cost || 25
        };
        
        Object.entries(stats).forEach(([id, value]) => {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = typeof value === 'number' ? value.toLocaleString() : value;
            // Add pulse effect for updates
            element.classList.add('animate-pulse-neon');
            setTimeout(() => {
              element.classList.remove('animate-pulse-neon');
            }, 1000);
          }
        });
        
        // Update user stats display
        this.updateUserStats();
      }
      
      updateTrendingContent(trendingContent) {
        // Update trending content cards if they exist on the page
        // This would update the vote counts on content items
        if (trendingContent.length > 0) {
          console.log('üìà Updating trending content:', trendingContent);
          // Implementation would depend on the specific content cards structure
        }
      }
      
      startRealTimeUpdates() {
        console.log('üîÑ Starting real-time voting updates...');
        
        // Subscribe to real-time voting updates via WebSocket
        if (window.MLGWebSocketManager) {
          window.MLGWebSocketManager.subscribe('voting', (data) => {
            if (data.success && data.data) {
              this.votingData = { activeVotes: data.data };
              this.updateLiveStats();
              this.updateActiveVotes(data.data);
            }
          });
          
          // Subscribe to user profile updates for vote counts
          window.MLGWebSocketManager.subscribe('profile', (data) => {
            if (data.success && data.data) {
              this.userStats = {
                votesRemaining: data.data.dailyVotesRemaining || this.userStats.votesRemaining,
                votesToday: data.data.votesToday || this.userStats.votesToday,
                mlgBalance: data.data.mlgBalance || this.userStats.mlgBalance
              };
              this.updateUserStats();
            }
          });
          
          console.log('‚úÖ WebSocket subscriptions active for voting updates');
        } else {
          // Fallback to periodic polling
          console.log('‚ö†Ô∏è WebSocket not available, using polling fallback');
          
          this.stopRealTimeUpdates = setInterval(async () => {
            try {
              const activeVotes = await window.MLGApiClient.getActiveVotes();
              if (activeVotes) {
                this.votingData.activeVotes = activeVotes;
                this.updateLiveStats();
                this.updateActiveVotes(activeVotes);
              }
            } catch (error) {
              console.warn('Periodic voting update failed:', error);
            }
          }, 15000); // Update every 15 seconds
          
          // Also refresh user profile periodically
          this.stopProfileUpdates = setInterval(async () => {
            try {
              const userProfile = await window.MLGApiClient.getUserProfile();
              if (userProfile) {
                this.userStats = {
                  votesRemaining: userProfile.dailyVotesRemaining || this.userStats.votesRemaining,
                  votesToday: userProfile.votesToday || this.userStats.votesToday,
                  mlgBalance: userProfile.mlgBalance || this.userStats.mlgBalance
                };
                this.updateUserStats();
              }
            } catch (error) {
              console.warn('Profile update failed:', error);
            }
          }, 30000); // Update every 30 seconds
        }
      }
      
      showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 transition-all transform translate-x-full shadow-lg border ${
          type === 'success' ? 'bg-gaming-accent text-black border-green-400' :
          type === 'error' ? 'bg-gaming-red border-red-400' :
          type === 'warning' ? 'bg-gaming-yellow text-black border-yellow-400' :
          'bg-gaming-blue border-blue-400'
        }`;
        
        // Add icon and enhanced styling
        const icon = type === 'success' ? 'üî•' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
        notification.innerHTML = `
          <div class="flex items-center space-x-2">
            <span class="text-lg">${icon}</span>
            <span>${message}</span>
          </div>
        `;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
          notification.classList.remove('translate-x-full');
        }, 100);
        
        // Animate out
        const duration = type === 'error' ? 6000 : type === 'warning' ? 5000 : 4000;
        setTimeout(() => {
          notification.classList.add('translate-x-full');
          setTimeout(() => {
            if (document.body.contains(notification)) {
              document.body.removeChild(notification);
            }
          }, 300);
        }, duration);
        
        // Click to dismiss
        notification.addEventListener('click', () => {
          notification.classList.add('translate-x-full');
          setTimeout(() => {
            if (document.body.contains(notification)) {
              document.body.removeChild(notification);
            }
          }, 300);
        });
      }

      generateVotersLeaderboard() {
        return [
          { username: 'TokenMaster2024', votes: 1247, mlgBurned: 31175, rank: 1, verified: true },
          { username: 'VoteKing', votes: 891, mlgBurned: 22275, rank: 2, verified: true },
          { username: 'CryptoVoter', votes: 723, mlgBurned: 18075, rank: 3, verified: false },
          { username: 'MLGBurner', votes: 654, mlgBurned: 16350, rank: 4, verified: true },
          { username: 'VoteWhale', votes: 589, mlgBurned: 14725, rank: 5, verified: false },
          { username: 'PowerVoter', votes: 512, mlgBurned: 12800, rank: 6, verified: true },
          { username: 'BurnMaster', votes: 456, mlgBurned: 11400, rank: 7, verified: false },
          { username: 'VoteHero', votes: 387, mlgBurned: 9675, rank: 8, verified: true }
        ];
      }

      updateVotersLeaderboard() {
        const leaderboard = this.generateVotersLeaderboard();
        const container = document.getElementById('voters-leaderboard');
        
        if (!container) return;

        container.innerHTML = leaderboard.map((voter, index) => {
          const rankColor = index === 0 ? 'text-yellow-400' : 
                           index === 1 ? 'text-gray-300' : 
                           index === 2 ? 'text-amber-600' : 'text-gray-400';
          
          const rankIcon = index === 0 ? 'üëë' : 
                          index === 1 ? 'ü•à' : 
                          index === 2 ? 'ü•â' : `#${index + 1}`;

          return `
            <div class="flex items-center justify-between p-3 bg-gaming-surface rounded-lg hover:bg-opacity-80 transition-all">
              <div class="flex items-center space-x-3">
                <div class="text-lg font-bold ${rankColor} min-w-[2rem] text-center">
                  ${rankIcon}
                </div>
                <div>
                  <div class="flex items-center space-x-2">
                    <span class="font-semibold text-white">${voter.username}</span>
                    ${voter.verified ? '<i data-lucide="check-circle" class="w-4 h-4 text-gaming-accent"></i>' : ''}
                  </div>
                  <div class="text-xs text-gray-400">
                    ${voter.mlgBurned.toLocaleString()} MLG burned
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-lg font-bold text-gaming-accent">${voter.votes.toLocaleString()}</div>
                <div class="text-xs text-gray-400">votes</div>
              </div>
            </div>
          `;
        }).join('');

        // Re-initialize Lucide icons for the new content
        if (window.lucide) {
          window.lucide.createIcons();
        }
      }

      setActiveVoteSortButton(clickedButton) {
        // Remove active class from all sort buttons
        document.querySelectorAll('.vote-sort-btn').forEach(btn => {
          btn.classList.remove('bg-gaming-blue', 'text-white');
          btn.classList.add('bg-gaming-surface');
        });
        
        // Add active class to clicked button
        clickedButton.classList.add('bg-gaming-blue', 'text-white');
        clickedButton.classList.remove('bg-gaming-surface');
      }

      sortVoteContent(sortType) {
        console.log(`üó≥Ô∏è Sorting vote content by: ${sortType}`);
        
        const contentContainer = document.getElementById('content-list');
        if (!contentContainer) return;
        
        const contentItems = Array.from(contentContainer.children);
        
        // Generate sorting data if not present
        contentItems.forEach((item, index) => {
          if (!item.dataset.voteData) {
            const baseVotes = Math.floor(Math.random() * 500) + 50;
            const voteCost = [0, 25, 50, 75, 100][Math.floor(Math.random() * 5)];
            const hoursOld = Math.floor(Math.random() * 48) + 1;
            
            item.dataset.voteData = JSON.stringify({
              votes: baseVotes,
              cost: voteCost,
              timestamp: Date.now() - (hoursOld * 60 * 60 * 1000),
              trendingScore: baseVotes * (voteCost + 1) / (hoursOld + 1)
            });
          }
        });
        
        // Sort items based on type
        contentItems.sort((a, b) => {
          const aData = JSON.parse(a.dataset.voteData || '{}');
          const bData = JSON.parse(b.dataset.voteData || '{}');
          
          switch(sortType) {
            case 'latest':
              return (bData.timestamp || 0) - (aData.timestamp || 0);
            case 'trending':
              return (bData.trendingScore || 0) - (aData.trendingScore || 0);
            case 'top':
              return (bData.votes || 0) - (aData.votes || 0);
            case 'cost':
              return (bData.cost || 0) - (aData.cost || 0);
            default:
              return 0;
          }
        });
        
        // Re-append sorted items with animation
        contentItems.forEach((item, index) => {
          setTimeout(() => {
            contentContainer.appendChild(item);
            item.style.opacity = '0';
            item.style.transform = 'translateX(20px)';
            
            setTimeout(() => {
              item.style.transition = 'all 0.3s ease';
              item.style.opacity = '1';
              item.style.transform = 'translateX(0)';
            }, 50);
          }, index * 75);
        });
        
        // Update UI to reflect sort
        this.showNotification(`üìä Vote content sorted by ${this.getVoteSortDisplayName(sortType)}`, 'info');
      }

      getVoteSortDisplayName(sortType) {
        const names = {
          latest: 'newest submissions',
          trending: 'trending score',
          top: 'highest votes',
          cost: 'vote cost'
        };
        return names[sortType] || sortType;
      }

      startVotersLeaderboardUpdates() {
        // Update leaderboard immediately
        this.updateVotersLeaderboard();
        
        // Update every 30 seconds with slight variations
        setInterval(() => {
          this.updateVotersLeaderboard();
        }, 30000);
      }
    }
    
    // Universal navigation handler for both SPA and multi-page modes
    function handleNavigation(event, pageUrl) {
      // Check if SPA router is available and ready
      if (window.router && window.router.push && typeof window.router.push === 'function') {
        event.preventDefault();
        const routePath = '/' + pageUrl.replace('.html', '').replace('index', 'dashboard');
        window.router.push(routePath);
      }
      // If no SPA router, let the default link behavior happen (multi-page navigation)
    }
    
    // Active navigation state management
    function updateActiveNavigation(currentPage) {
      // Remove active class from all nav links
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('bg-gaming-accent', 'text-black');
        link.classList.add('text-gray-300');
      });
      
      // Add active class to current page link
      const activeLink = document.querySelector(`.nav-link[href="${currentPage}"]`);
      if (activeLink) {
        activeLink.classList.remove('text-gray-300');
        activeLink.classList.add('bg-gaming-accent', 'text-black');
      }
    }
    
    // Make navigation functions globally available
    window.handleNavigation = handleNavigation;
    window.updateActiveNavigation = updateActiveNavigation;
    
      showBuyVotesDialog() {
        // Create modal for buying additional votes with MLG tokens
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        modal.innerHTML = `
          <div class="bg-gaming-surface border border-gaming-accent rounded-lg p-6 max-w-md mx-4">
            <h3 class="text-xl font-bold mb-4 text-gaming-accent">üî• Buy Additional Votes</h3>
            <p class="text-gray-300 mb-4">Purchase additional votes by burning MLG tokens.</p>
            <div class="space-y-3">
              <div class="flex justify-between items-center p-3 bg-gaming-bg rounded border border-gaming-accent border-opacity-20">
                <span>1 Vote</span>
                <span class="text-gaming-yellow font-bold">25 MLG</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-gaming-bg rounded border border-gaming-accent border-opacity-20">
                <span>5 Votes</span>
                <span class="text-gaming-yellow font-bold">100 MLG <small class="text-green-400">(20% off!)</small></span>
              </div>
              <div class="flex justify-between items-center p-3 bg-gaming-bg rounded border border-gaming-accent border-opacity-20">
                <span>10 Votes</span>
                <span class="text-gaming-yellow font-bold">175 MLG <small class="text-green-400">(30% off!)</small></span>
              </div>
            </div>
            <div class="flex space-x-3 mt-6">
              <button class="flex-1 bg-gaming-accent hover:bg-green-400 text-black px-4 py-2 rounded font-bold transition-colors" onclick="window.MLGErrorHandler.createNotification({type:'info', title:'üõí Coming Soon', message:'Vote purchasing will be available in next update!', icon:'üéÆ'}); this.parentElement.parentElement.parentElement.remove();">Buy Votes</button>
              <button class="flex-1 bg-gray-600 hover:bg-gray-500 px-4 py-2 rounded font-bold transition-colors" onclick="this.parentElement.parentElement.parentElement.remove();">Cancel</button>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        
        // Remove modal when clicking outside
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
          }
        });
      }
      
      async connectWallet() {
        try {
          // Use the Web3 wallet connection system
          if (window.phantom && window.phantom.solana) {
            await window.phantom.solana.connect();
            window.MLGErrorHandler.createNotification({
              type: 'success',
              title: 'üéÆ Wallet Connected',
              message: 'Phantom wallet connected successfully!',
              icon: 'üîå'
            });
            
            // Refresh user profile to get wallet data
            await this.loadVotingData();
          } else {
            window.MLGErrorHandler.createNotification({
              type: 'error',
              title: '‚ùå Wallet Not Found',
              message: 'Please install Phantom wallet extension',
              icon: 'üéÆ'
            });
          }
        } catch (error) {
          console.error('Wallet connection failed:', error);
        }
      }
      
      // Cleanup function for real-time updates
      destroy() {
        if (this.stopRealTimeUpdates) {
          this.stopRealTimeUpdates();
        }
        if (this.stopProfileUpdates) {
          this.stopProfileUpdates();
        }
      }
    }

    // Initialize when DOM is ready
    let votingPlatform;
    document.addEventListener('DOMContentLoaded', () => {
      votingPlatform = new VotingPlatform();
    });
    
    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (votingPlatform) {
        votingPlatform.destroy();
      }
    });
  </script>
</body>
</html>